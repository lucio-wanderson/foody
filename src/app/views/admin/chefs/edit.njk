{%extends "admin/layout.njk"%}

{%block head%}
    <title>AdminFoodfy-chef-edit</title>
{%endblock head%}

{% block content %}
    <div id="top-content">
        <h1>Edição de chefs</h1>
    </div>

    <form action="/admin/chefs?_method=PUT" method="POST">

        <div class="item_form">
            <div>Nome do chef</div>
            <div>
                <input type="text" name="name" value={{chef.name}}>
            </div>
        </div>

        <div class="item_form">
            <div>Avatar</div>
            <div>
                <input type="text" name="name" value={{chef.name}}>
            </div>
        </div>

        <div class="item-form">
            <div>Avatar</div>
            <div id=image-upload>
                <input type="file" 
                    id="image-input"
                    name="photo"
                    multiple="multiple"
                    accept="image/*"
                    onchange="ImageChefUpload()">

                <p id="send-avatar">Enviar avatar</p>
            </div>
        </div>

        <input type="hidden" name="id" value="{{chef.id}}">

        <button class="editButton" type="submit">SALVAR</button>

    </form>

    <form id="form_delete" action="/admin/chefs?_method=DELETE" method="POST">
        <input type="hidden" name="id" value="{{chef.id}}">
        <input type="hidden" id="total_recipes" name="total_recipes" value={{chef.total_recipes}}>
        <button id="delete-chef" class="delete-chef" type="submit">DELETAR</button>
    </form>

{%endblock content%}

{%block script%}
    <script>
        const formDelete = document.querySelector('#form_delete')
        const totalRecipes = document.querySelector('#total_recipes')
        console.log(totalRecipes.getAttribute('value'))

        formDelete.addEventListener('submit', function (event) {
            const confirmation = window.confirm("Deseja deletar?")
            if (!confirmation) {
                event.preventDefault()
            } else if (Number(totalRecipes) > 0) {
                window.alert("Esse Chef não pode ser excuído, pois existem receitas registradas em sua autoria, por favor, exclua todas as receitas do mesmo, depois tente excluí-lo novemente")
                event.preventDefault()
            }

        })
    </script>
{%endblock script%}